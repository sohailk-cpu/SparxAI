<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SunoAi</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <h1>SunoAi</h1>
        <div class="chat-container">
            <div id="chat-box" class="chat-box"></div>
            <input type="text" class="chat-input" placeholder="Type your message...">
            <button id="mic-btn">ðŸŽ¤ Speak</button>
        </div>
    </div>
<script>
    const chatInput = document.querySelector('.chat-input');
    const chatBox = document.getElementById('chat-box');
    const micBtn = document.getElementById('mic-btn');

    chatInput.addEventListener('keypress', function (e) {
        if (e.key === 'Enter') {
            sendMessage(chatInput.value.trim());
        }
    });

    micBtn.addEventListener("click", () => {
        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.lang = "hi-IN";
        recognition.start();
        micBtn.textContent = "ðŸŽ™ï¸ Listening...";
        recognition.onresult = function (event) {
            const text = event.results[0][0].transcript;
            chatInput.value = text;
            sendMessage(text);
            micBtn.textContent = "ðŸŽ¤ Speak";
        };
        recognition.onerror = function () {
            micBtn.textContent = "ðŸŽ¤ Speak";
        };
    });

    function sendMessage(message) {
        if (message === '') return;
        const userDiv = document.createElement('div');
        userDiv.className = 'user';
        userDiv.textContent = "ðŸ§‘: " + message;
        chatBox.appendChild(userDiv);

        fetch("/chat", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message })
        })
        .then(res => res.json())
        .then(data => {
            const botDiv = document.createElement('div');
            botDiv.className = 'bot';
            botDiv.textContent = "ðŸ¤–: " + data.response;
            chatBox.appendChild(botDiv);
            speakText(data.response);
            chatBox.scrollTop = chatBox.scrollHeight;
        });

        chatInput.value = '';
    }

    function speakText(text) {
        const synth = window.speechSynthesis;
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = "hi-IN";
        const voices = synth.getVoices();
        const hindiVoice = voices.find(voice => voice.lang === 'hi-IN');
        if (hindiVoice) utterance.voice = hindiVoice;
        synth.speak(utterance);
    }
</script>
</body>
</html>
